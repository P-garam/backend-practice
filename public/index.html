<!DOCTYPE html>
<html>
<head>
  <title>게시글 작성</title>
</head>
<body>
  <h1>게시글 작성</h1>
  <form id="postForm">
    <label for="title">제목:</label>
    <input type="text" id="title" name="title" required><br><br>
    <label for="content">내용:</label>
    <textarea id="content" name="content" required></textarea><br><br>
    <label for="author">작성자:</label>
    <input type="text" id="author" name="author" required><br><br>
    <button type="submit">게시글 작성</button>
  </form>

  <h2>게시글 목록</h2>
  <div id="posts"></div>

  <script>
    document.getElementById('postForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const author = document.getElementById('author').value;

      try {
        const response = await fetch('/posts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ title, content, author })
        });

        if (!response.ok) {
          throw new Error('게시글 작성에 실패했습니다.');
        }

        alert('게시글이 작성되었습니다.');
        loadPosts(); // 게시글 목록 다시 불러오기
      } catch (error) {
        alert(error.message);
      }
    });

    async function loadPosts() {
      try {
        const response = await fetch('http://localhost:3001/api/posts');
        if (!response.ok) {
          throw new Error('게시글 목록을 불러오는데 실패했습니다.');
        }

        const posts = await response.json();
        const postsDiv = document.getElementById('posts');
        postsDiv.innerHTML = '';

        posts.forEach(post => {
          const postElement = document.createElement('div');
          postElement.innerHTML = `<h3>${post.title}</h3>`;

          // 게시글 제목 클릭 시 해당 게시글의 상세 페이지로 이동
          postElement.addEventListener('click', function() {
            window.location.href = `/post.html?id=${post._id}`;
          });

          postsDiv.appendChild(postElement);
        });
      } catch (error) {
        console.error(error);
      }
    }

    // 페이지 로드 시 게시글 목록 불러오기
    window.onload = loadPosts;
  </script>
</body>
</html>
